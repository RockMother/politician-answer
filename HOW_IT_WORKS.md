# ะะฐะบ ัะฐะฑะพัะฐะตั ะฑะพั

## ะะพะณะธะบะฐ ัะฐะฑะพัั

### ะจะฐะณ 1: ะะพะปัะทะพะฒะฐัะตะปั ัะตะณะฐะตั ะฑะพัะฐ

1. ะ ัะฐัะต ะตััั **ัะพะพะฑัะตะฝะธะต A** (ะพัะธะณะธะฝะฐะปัะฝะพะต ะฟะพะปะธัะธัะตัะบะพะต ะฒััะบะฐะทัะฒะฐะฝะธะต)
2. ะะพะปัะทะพะฒะฐัะตะปั ะดะตะปะฐะตั **Reply** ะฝะฐ ัะพะพะฑัะตะฝะธะต A
3. ะ ัะตะบััะต reply ะฟะพะปัะทะพะฒะฐัะตะปั ะฟะธัะตั `@politician_answer_bot` (ะธะปะธ ะปัะฑะพะน ัะตะบัั ั ัะฟะพะผะธะฝะฐะฝะธะตะผ)

```
ะกะพะพะฑัะตะฝะธะต A (ะพัะธะณะธะฝะฐะป): "ะะฐะปะพะณะธ ะฝัะถะฝะพ ะฟะพะฒััะฐัั ะดะปั ัะฐะทะฒะธัะธั ัะบะพะฝะพะผะธะบะธ"
    โโ Reply ะพั ะฟะพะปัะทะพะฒะฐัะตะปั: "@politician_answer_bot ะพัะฒะตัั"
```

### ะจะฐะณ 2: ะะพั ะพะฑัะฐะฑะฐััะฒะฐะตั ะทะฐะฟัะพั

ะะพั ะฟัะพะฒะตััะตั:
- โ ะััั ะปะธ reply? (`ctx.message.reply_to_message`)
- โ ะฃะฟะพะผัะฝัั ะปะธ ะฑะพั ะฒ ัะตะบััะต? (`@politician_answer_bot` ะฒ ัะตะบััะต)

ะัะปะธ ะพะฑะฐ ััะปะพะฒะธั ะฒัะฟะพะปะฝะตะฝั โ ะฟัะพะดะพะปะถะฐะตะผ

### ะจะฐะณ 3: ะะพั ัะธัะฐะตั ะะะะะะะะะฌะะะ ัะพะพะฑัะตะฝะธะต

```javascript
const originalMessage = ctx.message.reply_to_message;  // ะกะพะพะฑัะตะฝะธะต A
const postText = originalMessage?.text || originalMessage?.caption;
```

ะะพั ะฑะตัะตั ัะตะบัั ะธะท **ัะพะพะฑัะตะฝะธั A** (ะฝะต ะธะท reply ะฟะพะปัะทะพะฒะฐัะตะปั!)

### ะจะฐะณ 4: ะะตะฝะตัะฐัะธั ะพัะฒะตัะฐ ัะตัะตะท OpenAI

```javascript
const oppositeReply = await generateOppositeReply(systemPrompt, postText);
```

OpenAI ะฟะพะปััะฐะตั:
- System prompt: "ะขั ััะพััะฝัะน ะฟะพะปะธัะธัะตัะบะธะน ะดะตะฑะฐัะตั..."
- User message: ัะตะบัั ะธะท **ัะพะพะฑัะตะฝะธั A**

OpenAI ะณะตะฝะตัะธััะตั ะฟัะพัะธะฒะพะฟะพะปะพะถะฝัั ัะพัะบั ะทัะตะฝะธั.

### ะจะฐะณ 5: ะะพั ะพัะฒะตัะฐะตั ะฝะฐ ะะะะะะะะะฌะะะ ัะพะพะฑัะตะฝะธะต

```javascript
await ctx.reply(oppositeReply, {
  reply_parameters: {
    message_id: originalMessage!.message_id  // ID ัะพะพะฑัะตะฝะธั A
  }
});
```

ะะตะทัะปััะฐั ะฒ ัะฐัะต:

```
ะกะพะพะฑัะตะฝะธะต A (ะพัะธะณะธะฝะฐะป): "ะะฐะปะพะณะธ ะฝัะถะฝะพ ะฟะพะฒััะฐัั ะดะปั ัะฐะทะฒะธัะธั ัะบะพะฝะพะผะธะบะธ"
    โโ Reply ะพั ะฟะพะปัะทะพะฒะฐัะตะปั: "@politician_answer_bot ะพัะฒะตัั"
    โโ Reply ะพั ะฑะพัะฐ: "ะะฐะพะฑะพัะพั! ะะพะฒััะตะฝะธะต ะฝะฐะปะพะณะพะฒ ะดััะธั ะฑะธะทะฝะตั..."
```

## ะะธะทัะฐะปัะฝะฐั ััะตะผะฐ

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะพะพะฑัะตะฝะธะต A                                 โ
โ "ะะฐะปะพะณะธ ะฝัะถะฝะพ ะฟะพะฒััะฐัั"                     โ
โ (ะฐะฒัะพั: @user1)                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
          โ reply                       โ reply
โโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ะกะพะพะฑัะตะฝะธะต B (trigger)   โ   โ ะกะพะพะฑัะตะฝะธะต C (ะพัะฒะตั)     โ
โ "@bot ะพัะฒะตัั"           โ   โ "ะะฐะพะฑะพัะพั! ะะพะฒััะตะฝะธะต..." โ
โ (ะฐะฒัะพั: @user2)         โ   โ (ะฐะฒัะพั: @bot)            โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ะงัะพ ะฒะธะดะฝะพ ะฒ ะปะพะณะฐั

ะัะธ ะฟัะฐะฒะธะปัะฝะพะน ัะฐะฑะพัะต ะฒั ัะฒะธะดะธัะต:

```
๐จ Received message:
   messageId: 12345
   from: user2
   text: "@politician_answer_bot ะพัะฒะตัั"
   hasReply: true

โ Bot mentioned in text (fallback check): @politician_answer_bot
โ Bot mentioned! Processing...

๐ Original message details:
   originalMessageId: 12344
   originalFrom: user1
   originalText: "ะะฐะปะพะณะธ ะฝัะถะฝะพ ะฟะพะฒััะฐัั ะดะปั ัะฐะทะฒะธัะธั ัะบะพะฝะพะผะธะบะธ"

๐ค Generating AI response for: ะะฐะปะพะณะธ ะฝัะถะฝะพ ะฟะพะฒััะฐัั...

๐ฌ Generated reply (first 100 chars): ะะฐะพะฑะพัะพั! ะะพะฒััะตะฝะธะต ะฝะฐะปะพะณะพะฒ ะดััะธั ะฑะธะทะฝะตั ะธ ะพัะฟัะณะธะฒะฐะตั ะธะฝะฒะตััะพัะพะฒ...

โ Successfully sent reply to message 12344
```

## ะะฐะถะฝัะต ะดะตัะฐะปะธ

### ะะพั ะะ ะพัะฒะตัะฐะตั ะฝะฐ:
- โ ะััะผัะต ัะฟะพะผะธะฝะฐะฝะธั ะฑะตะท reply (`@bot ะฟัะธะฒะตั` ะฒ ะฟัััะพะต)
- โ Reply ะฑะตะท ัะฟะพะผะธะฝะฐะฝะธั ะฑะพัะฐ (ะฟัะพััะพ ะพัะฒะตั ะฝะฐ ัะพะพะฑัะตะฝะธะต)
- โ ะกะพะพะฑัะตะฝะธั ะฑะตะท ัะตะบััะฐ (ัะพัะพ, ััะธะบะตัั, ัะฐะนะปั ะฑะตะท caption)

### ะะพั ะพัะฒะตัะฐะตั ะฝะฐ:
- โ Reply + ัะฟะพะผะธะฝะฐะฝะธะต ะฑะพัะฐ
- โ Reply ั ัะตะบััะพะผ ะธะปะธ caption
- โ ะะฐะฑะพัะฐะตั ะฒ ะณััะฟะฟะฐั ะธ ะฟัะธะฒะฐัะฝัั ัะฐัะฐั (ะตัะปะธ Privacy Mode ะฒัะบะปััะตะฝ)

## ะะพะฝัะธะณััะฐัะธั ะฟัะพะผะฟัะฐ

ะัะพะผะฟั ะพะฟัะตะดะตะปัะตั, **ะบะฐะบ** ะฑะพั ะฑัะดะตั ะพัะฒะตัะฐัั (ะฟะพ ัะผะพะปัะฐะฝะธั - ะฟัะพัะธะฒะพะฟะพะปะพะถะฝะฐั ัะพัะบะฐ ะทัะตะฝะธั).

ะะทะผะตะฝะธัั ะผะพะถะฝะพ ัะตัะตะท:
1. `/setprompt` ะบะพะผะฐะฝะดั (ะฒัะตะผะตะฝะฝะพ, ะดะพ ะฟะตัะตะทะฐะฟััะบะฐ)
2. Environment variable `OPENAI_SYSTEM_PROMPT`
3. ะคะฐะนะป `config/prompt.txt`
4. ะะตัะพะปัะฝัะน ะฟัะพะผะฟั ะฒ `src/config.ts`

## ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะธะผะตั 1: ะะพะปะธัะธะบะฐ

```
ะัะธะณะธะฝะฐะป: "ะกะฒะพะฑะพะดะฐ ัะปะพะฒะฐ ะดะพะปะถะฝะฐ ะฑััั ะฐะฑัะพะปััะฝะพะน"
ะะพั: "ะะฑัะพะปััะฝะฐั ัะฒะพะฑะพะดะฐ ัะปะพะฒะฐ ะฒะตะดะตั ะบ ัะฐะพัั ะธ ัะฐัะฟัะพัััะฐะฝะตะฝะธั ะดะตะทะธะฝัะพัะผะฐัะธะธ..."
```

### ะัะธะผะตั 2: ะญะบะพะฝะพะผะธะบะฐ

```
ะัะธะณะธะฝะฐะป: "ะัะธะฟัะพะฒะฐะปััะฐ - ะฑัะดััะตะต ัะธะฝะฐะฝัะพะฒ"
ะะพั: "ะัะธะฟัะพะฒะฐะปััั ะฝะตััะฐะฑะธะปัะฝั, ะธัะฟะพะปัะทััััั ะดะปั ะพัะผัะฒะฐะฝะธั ะดะตะฝะตะณ..."
```

### ะัะธะผะตั 3: ะกะพัะธะฐะปัะฝัะต ะฒะพะฟัะพัั

```
ะัะธะณะธะฝะฐะป: "ะฃะดะฐะปะตะฝะบะฐ ะฟะพะฒััะฐะตั ะฟัะพะดัะบัะธะฒะฝะพััั"
ะะพั: "ะฃะดะฐะปะตะฝะฝะฐั ัะฐะฑะพัะฐ ัะฐะทัััะฐะตั ะบะพะผะฐะฝะดะฝัะน ะดัั ะธ ัะฝะธะถะฐะตั ะบัะตะฐัะธะฒะฝะพััั..."
```

## FAQ

**Q: ะะพั ะพัะฒะตัะฐะตั ะฝะฐ ัะฒะพะต ะถะต ัะพะพะฑัะตะฝะธะต?**  
A: ะะตั, ะฑะพั ะพัะฒะตัะฐะตั ะฝะฐ **ะพัะธะณะธะฝะฐะปัะฝะพะต** ัะพะพะฑัะตะฝะธะต (ัะพ, ะฝะฐ ะบะพัะพัะพะต ะฑัะป ัะดะตะปะฐะฝ reply ั ัะฟะพะผะธะฝะฐะฝะธะตะผ)

**Q: ะะพะถะฝะพ ะปะธ ะธัะฟะพะปัะทะพะฒะฐัั ะฒ ะฝะตัะบะพะปัะบะธั ะณััะฟะฟะฐั?**  
A: ะะฐ! ะะดะธะฝ ะฑะพั ัะฐะฑะพัะฐะตั ะฒ ะฝะตะพะณัะฐะฝะธัะตะฝะฝะพะผ ะบะพะปะธัะตััะฒะต ะณััะฟะฟ ะพะดะฝะพะฒัะตะผะตะฝะฝะพ

**Q: ะะพั ะฒะธะดะธั ะธััะพัะธั ัะฐัะฐ?**  
A: ะะตั, ะฑะพั ะฒะธะดะธั ัะพะปัะบะพ **ะพะดะฝะพ ะบะพะฝะบัะตัะฝะพะต ัะพะพะฑัะตะฝะธะต**, ะฝะฐ ะบะพัะพัะพะต ะฑัะป reply

**Q: ะะพะถะฝะพ ะธะทะผะตะฝะธัั ัะพะฝ ะพัะฒะตัะพะฒ?**  
A: ะะฐ, ัะตัะตะท `/setprompt` ะธะปะธ ะฟะตัะตะผะตะฝะฝัั `OPENAI_SYSTEM_PROMPT`
